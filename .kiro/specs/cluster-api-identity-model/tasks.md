# 実装計画

- [x] 1. Identityモデルの基盤を整備する
  - _対応要件: 1.1, 1.2, 1.3, 1.4_
  - _依存タスク: -_
- [x] 1.1 Identityの生成・検証・同一性判定を実装する
  - kind/identity を保持し、取得できる状態にする
  - 空文字の入力を検出して失敗として扱う
  - key を `kind/identity` 形式で生成できるようにする
  - kind と identity の一致で同一性を判定できるようにする
  - _対応要件: 1.1, 1.2, 1.3, 1.4_
  - _依存タスク: -_
  - _完了条件: Identity の生成と検証、同一性判定が可能になっている_
- [x] 1.2 Identityモデルの単体テストを整備する
  - 正常生成とキー形式の確認を行う
  - 空文字入力が失敗になることを確認する
  - 同一性判定とハッシュの安定性を検証する
  - _対応要件: 1.1, 1.2, 1.3, 1.4_
  - _依存タスク: 1.1_
  - _完了条件: Identityの正負ケースがテストで確認できる_

- [x] 2. クラスタAPI取得と起動・種別の検証を整備する
  - _対応要件: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 4.3_
  - _依存タスク: 1.2_
- [x] 2.1 ActorSystem からクラスタAPIを取得できるようにする
  - 拡張が導入済みの場合に取得できるようにする
  - 複数回取得時に同一の拡張に紐づくハンドルを返す
  - 拡張が未導入の場合は明確な失敗を返す
  - _対応要件: 2.1, 2.2, 2.3_
  - _依存タスク: 1.1_
  - _完了条件: 取得の成功と失敗が区別できる_
- [x] 2.2 起動状態と種別未登録を検証して失敗を返す
  - 未起動状態での取得/解決が失敗になるようにする
  - 種別が未登録の場合に解決やリクエストを失敗とする
  - 種別登録がIdentityLookupに反映される前提を満たすよう整合を取る
  - _対応要件: 3.1, 3.2, 3.3, 4.3_
  - _依存タスク: 2.1_
  - _完了条件: 起動/種別未整備の失敗が判定できる_
- [x] 2.3 取得・起動・種別検証の単体テストを整備する
  - 拡張未導入時の失敗を確認する
  - 未起動時に失敗が返ることを確認する
  - 未登録種別が失敗になることを確認する
  - _対応要件: 2.1, 2.2, 2.3, 3.3, 4.3_
  - _依存タスク: 2.1, 2.2_
  - _完了条件: 取得/起動/種別の失敗系が再現できる_

- [x] 3. PID解決フローを実装する
  - _対応要件: 4.1, 4.2_
  - _依存タスク: 2.2_
- [x] 3.1 IdentityLookup からPIDを解決しActorRefに変換する
  - Identityからキーを生成して解決に使う
  - PID文字列を取得し `authority::path` として扱う
  - authority と path を分解し canonical 形式へ組み立てる
  - ActorRef を解決して返せるようにする
  - _対応要件: 4.1_
  - _依存タスク: 2.2_
  - _完了条件: IdentityからActorRefの解決が可能になる_
- [x] 3.2 PID形式不正や解決不能のエラー処理を整理する
  - PIDが取得できない場合の失敗を定義する
  - PID形式不正の失敗を分類する
  - ActorRef 解決失敗を分類する
  - _対応要件: 4.2_
  - _依存タスク: 3.1_
  - _完了条件: 解決失敗の分類が明確になっている_
- [x] 3.3 PID解決の単体テストを整備する
  - 解決成功ケースを確認する
  - PID形式不正の失敗を確認する
  - 解決不能時の失敗を確認する
  - _対応要件: 4.1, 4.2_
  - _依存タスク: 3.1, 3.2_
  - _完了条件: PID解決の正負ケースが検証できる_

- [x] 4. Request/RequestFuture APIを実装する
  - _対応要件: 5.1, 5.2, 5.3, 5.4_
  - _依存タスク: 3.2_
- [x] 4.1 Request送信の基本フローを実装する
- PID解決後にメッセージ送信を行う
  - 解決失敗時は送信せず失敗を返す
  - 送信失敗を適切に分類する
  - _対応要件: 5.1, 5.2_
  - _依存タスク: 3.2_
  - _完了条件: 送信の成功/失敗が判定できる_
- [x] 4.2 RequestFutureとタイムアウト処理を実装する
  - タイムアウト指定時に失敗として返す
  - 呼び出し側が待機可能な非同期ハンドルを返す
  - 同期/非同期で一貫したエラー処理を行う
  - _対応要件: 5.3, 5.4_
  - _依存タスク: 4.1_
  - _完了条件: タイムアウトと非同期ハンドルが動作する_
- [x] 4.3 Request系の単体テストを整備する
  - 正常送信の応答取得を確認する
  - 解決失敗やタイムアウトの失敗を確認する
  - 非同期ハンドルでの待機動作を確認する
  - _対応要件: 5.1, 5.2, 5.3, 5.4_
  - _依存タスク: 4.1, 4.2_
  - _完了条件: request系の正負ケースが検証できる_

- [x] 5. no_std/std整合と統合確認を行う
  - _対応要件: 6.1, 6.2_
  - _依存タスク: 4.2_
- [x] 5.1 no_std/std 共通性の整合を確認する
  - core で完結するAPIの振る舞いを確定する
  - std 側の追加が core の振る舞いを変えないことを確認する
  - no_std/std の両方で同一のAPI形状を保つ
  - _対応要件: 6.1, 6.2_
  - _依存タスク: 1.1, 2.1, 3.1, 4.1_
  - _完了条件: no_std/std で同一のAPI形状が維持されている_
- [x] 5.2 統合テストでクラスタAPIの基本フローを確認する
  - ActorSystem からAPI取得し request フローを通す
  - 未導入/未起動の失敗を統合シナリオで確認する
  - 最小構成での安定動作を確認する
  - _対応要件: 2.1, 2.2, 2.3, 4.1, 5.1_
  - _依存タスク: 2.1, 3.1, 4.1_
  - _完了条件: 最小の統合シナリオが通る_
