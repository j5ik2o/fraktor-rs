# 実装計画

- [x] 1. コアのストリーム構成要素を定義する
- [x] 1.1 Source/Flow/Sink の最小形状と接続可能性を整える
  - 入出力形状を表す抽象を用意し、組み合わせ可能な型安全境界を作る
  - StreamGraph へ登録可能な構成要素として扱えるようにする
  - _Requirements: 1.1_

- [x] 1.2 StreamGraph の接続管理と型不一致の拒否を整える
  - 接続関係を保持し、無効な接続を拒否できるようにする
  - 合成済み RunnableGraph を生成できるようにする
  - _Requirements: 1.2, 1.3, 2.1_

- [x] 2. マテリアライズ値の合成と実行開始の契約を整える
- [x] 2.1 MatCombine と Materialized の合成規則を定義する
  - 合成規則が一貫して適用されることを保証する
  - マテリアライズ値の組み合わせ規則を固定する
  - _Requirements: 2.2, 2.3_

- [x] 2.2 Materializer の起動・停止と実行状態の規約を整える
  - 実行開始/停止のライフサイクルを明確にする
  - StreamHandle が実行状態を管理できるようにする
  - _Requirements: 3.1, 3.2, 3.3_

- [x] 3. 需要伝播とバックプレッシャをコアに実装する
- [x] 3.1 DemandTracker の需要伝播と request(0) 拒否を整える
  - demand の合算と上限到達時の Unbounded 取り扱いを決める
  - 需要が無い場合に生成を抑止できるようにする
  - _Requirements: 4.1, 4.2_

- [x] 3.2 StreamBuffer のバッファ制御と容量方針を整える
  - 共通キュー実装を使ってバックプレッシャを制御する
  - 過剰なバッファ消費を抑制する
  - _Requirements: 4.3_

- [x] 4. 完了・失敗・キャンセルの伝播を実装する
- [x] 4.1 完了通知と失敗通知の伝播を整える
  - 正常完了と失敗の伝播ルールを定める
  - 完了状態が下流で観測可能になるようにする
  - _Requirements: 5.1, 5.2_

- [x] 4.2 キャンセル伝播と状態遷移の整合を確認する
  - キャンセルが上流へ伝播することを保証する
  - 状態遷移が単方向であることを確認する
  - _Requirements: 5.3_

- [x] 5. no_std/std 境界を保ちつつ core を完成させる
- [x] 5.1 core 側の no_std ビルド互換を確保する
  - std 依存を持ち込まない構成でビルドできることを確認する
  - core 公開 API が no_std で利用可能であることを確認する
  - _Requirements: 6.1, 6.3_

- [x] 5.2 std 拡張の境界を定義し、依存を隔離する
  - std 実装が core に依存する一方向の境界を維持する
  - std 無効時に依存が要求されない状態を作る
  - _Requirements: 6.2, 7.3_

- [x] 6. std 実行基盤との統合を整える
- [x] 6.1 TokioMaterializer で実行を駆動できるようにする
  - std 実行基盤との統合を有効化する
  - Materializer を通じた実行基盤利用を確認する
  - _Requirements: 7.1, 7.2_

- [x] 7. テストで最小構成の動作を確認する
- [x] 7.1 core の型不一致拒否と demand 制御の単体テストを追加する
  - 型不一致の拒否が観測できることを確認する
  - demand の抑止が機能することを確認する
  - _Requirements: 1.2, 4.2_

- [x] 7.2 完了/失敗/キャンセルの伝播テストを追加する
  - 完了と失敗が下流に到達することを確認する
  - キャンセルが上流へ伝播することを確認する
  - _Requirements: 5.1, 5.2, 5.3_

- [x] 7.3 std 統合と no_std ビルドの検証を追加する
  - TokioMaterializer の起動/停止を検証する
  - no_std/std の両方でビルドが通ることを確認する
  - _Requirements: 6.1, 6.2, 6.3, 7.1, 7.2, 7.3_

- [x] 8. examples を通じた最小利用例を用意する
- [x] 8.1 std 環境向けの最小ストリームサンプルを追加する
  - Source/Flow/Sink と Materializer の最小合成を示す
  - std 実行基盤で動作することを示す
  - core に std 依存を持ち込まない
  - _Requirements: 8.1, 8.2, 8.3_
